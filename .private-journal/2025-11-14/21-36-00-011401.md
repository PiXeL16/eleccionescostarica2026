---
title: "9:36:00 PM - November 14, 2025"
date: 2025-11-14T20:36:00.011Z
timestamp: 1763152560011
---

## Project Notes

## PDF and Citation Architecture Analysis for Elecciones2026

### Current Implementation:

**Database Schema (SQLite):**
- `documents`: Stores PDF metadata (file_path, page_count, word_count, source_url)
- `document_text`: Stores raw text extracted from each page (page_number, raw_text, markdown_text)
- `document_embeddings`: Stores vector embeddings of text chunks with page references
- `party_positions`: Stores summarized positions with categories
- `parties`: Stores party info with abbreviation (slug)

**Page Reference Tracking:**
- Page numbers ARE stored in `document_text.page_number` 
- Document embeddings link back to `document_text` which has page numbers
- In `chat-data.ts`: `SemanticSearchResult` includes `page_number` field (line 102)

**Current Citation Display:**
- Chat API returns results with `page_number` included
- `ChatSidebar.tsx` (line 100): Displays citations as "**Página X:**" before chunk text
- `ComparisonView.tsx` (line 15): Has helper function `formatTextWithCitations` that matches `[Página X]` or `[Páginas X-Y]` patterns
- Citations are styled with regex pattern: `\[Páginas? \d+(?:-\d+)?\]`

**PDF Access:**
- Currently NO direct PDF links in UI
- PDFs stored at: `data/partidos/[PARTY-NAME]/[ABBR].pdf`
- Database has `source_url` field (optional) but not used
- No deep linking implementation yet

**RAG Pattern:**
- Semantic search in `chat-data.ts`: Searches embeddings with vector similarity
- Returns: party_id, party_name, document_id, page_number, chunk_text, similarity
- Instructions in API (route.ts line 48-51): Explicitly require "[Página X]" citations in responses

### Gaps for Deep Linking:
1. No PDF URLs stored or served
2. No PDF viewer component
3. No way to navigate from citation to actual PDF page
4. No iframe/embed for PDF display
5. Source URLs optional and not utilized

### For Implementation:
- Need to expose PDFs via API (e.g., `/api/pdf/[party-id]`)
- Need to construct deep links: `/pdf/[party-id]?page=X`
- Need to make citations clickable in chat responses
- Could use pdf.js or similar for viewer component
- Page numbers are already tracked throughout the system

